# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## About This Branch

**Branch:** `main` (also available on `javascript-fork-v3.4.0`)
**Version:** 3.4.0
**Architecture:** JavaScript-only (no Rust dependencies)

This is a JavaScript-only fork of Tailwind CSS v3, originally based on v3.0.24 - the last version before the Rust/Oxide engine was introduced. The main branch has been upgraded with v3.4 features while maintaining the pure JavaScript/TypeScript architecture.

**Note:** Tailwind CSS v4 is a separate project with Rust/Oxide architecture. This repository focuses on the JavaScript-only v3.x implementation. All v3.x versions (3.0.24, 3.1.0, 3.2.0, 3.3.0, 3.4.0) are preserved in dedicated branches.

### v3.4.0 Update

The v3.4.0 release builds upon v3.3.0 and includes all previous features, ready for additional v3.4 enhancements.

**Inherited Features from v3.3.0:**
- ✅ Extended color palette with 950 shades (22 color families)
- ✅ Line-clamp utilities (`line-clamp-{1-6}`, `line-clamp-none`)
- ✅ Comprehensive logical properties (inset, margin, padding, border-radius, scroll)
- ✅ New utility classes (hyphens, caption-side, list-image, whitespace-break-spaces)
- ✅ Enhanced alignment utilities (justify-normal/stretch, content-normal/stretch)

**Inherited Features from v3.2.0:**
- ✅ ARIA attribute variants (`aria-checked:`, `aria-[disabled]:`)
- ✅ Data attribute variants (`data-[state=open]:`, `data-[loading]:`)
- ✅ CSS feature query variant (`supports-[display:grid]:`)
- ✅ Min/max media query variants (`min-[768px]:`, `max-[1024px]:`)
- ✅ Additional utilities (`break-keep`, `collapse`, `fill-none`, `stroke-none`, baseline alignment, negative outline-offset)

**Inherited Features from v3.1.0:**
- ✅ Arbitrary variants (`[&:hover]:text-red-500`, `[&_p]:text-sm`)
- ✅ New utilities (`border-spacing-*`, `text-start/end`, `grid-flow-dense`)
- ✅ New variants (`backdrop:`, `enabled:`, `optional:`, `contrast-more/less:`)

**Architecture:**
- All features maintain JavaScript-only architecture (no Rust/Oxide dependencies)
- Version-specific build system preserving all previous version builds
- Symlink packaging fix ensuring proper npm installation

## Commands

### Build and Development
```bash
# Install dependencies
npm install

# Build with version-specific folders (recommended)
npm run build

# Create version-specific tarball
npm run pack

# Build and package together
npm run build:pack

# Legacy build (outputs to lib/ without versioning)
npm run swcify

# Generate plugin list (run automatically by build)
npm run generate
```

### Testing
```bash
# Run all tests
npm test

# Run tests only (without linting)
npm run pretest && jest

# Run integration tests
npm run test:integrations

# Run specific test file
npx jest tests/[test-file].test.js
```

### Code Quality
```bash
# Check linting (ESLint + Prettier)
npm run style

# Auto-format code
npx prettier --write .
```

## Architecture

### Project Structure

This is a **single-package** JavaScript/TypeScript project (not a monorepo):

- **`src/`** - TypeScript/JavaScript source code
- **`lib/`** - Compiled output (generated by build process)
- **`scripts/`** - Build and utility scripts
- **`tests/`** - Jest test files
- **`integrations/`** - Integration test projects

### Core Components

**Main Entry Points:**
- **`src/index.js`** - Main library export, PostCSS plugin
- **`src/cli.js`** - Command-line interface
- **`src/processTailwindFeatures.js`** - Core processing pipeline

**Key Modules:**
- **`src/lib/generateRules.js`** - Utility and variant generation
- **`src/lib/setupContextUtils.js`** - Configuration and context management
- **`src/lib/expandTailwindAtRules.js`** - @tailwind directive processing
- **`src/lib/expandApplyAtRules.js`** - @apply directive processing
- **`src/corePlugins.js`** - Built-in utility definitions
- **`src/util/`** - Shared utility functions

**Public API:**
- **`src/public/colors.js`** - Color palette
- **`src/public/default-theme.js`** - Default theme configuration
- **`src/public/default-config.js`** - Default configuration
- **`src/public/resolve-config.js`** - Configuration resolution

### Version-Specific Build System

**Build Process:**
1. **Plugin generation** - Creates `src/corePluginList.js` from `src/corePlugins.js`
2. **SWC compilation** - Transpiles `src/` → `lib/VERSION/` (e.g., `lib/3.0.24/`)
3. **Peer bundling** - Bundles CLI peer dependencies with esbuild
4. **Symlink creation** - Creates `lib/*.js` symlinks → `lib/VERSION/*.js`

**Build Scripts:**
- **`scripts/build-versioned.js`** - Orchestrates versioned build
- **`scripts/pack-versioned.js`** - Creates versioned tarballs
- **`scripts/get-version.js`** - Extracts version from package.json
- **`scripts/create-plugin-list.js`** - Generates plugin list
- **`scripts/generate-types.js`** - Generates TypeScript definitions

**Output Structure:**
```
lib/
├── 3.0.24/              # Versioned build output
│   ├── index.js
│   ├── cli.js
│   ├── lib/
│   ├── css/
│   └── util/
├── index.js             # Symlink → 3.0.24/index.js
├── cli.js               # Symlink → 3.0.24/cli.js
└── ...                  # Other symlinks

dist/
├── 3.0.24/
│   └── tailwindcss-3.0.24.tgz
└── tailwindcss-3.0.24.tgz  # Copy for backwards compat

peers/
└── index.js             # Bundled peer dependencies
```

**Version Management:**
- Version is read from root `package.json`
- Each build creates/updates its version folder
- Old version folders are preserved
- Symlinks point to the most recent build
- Multiple versions can coexist

**Benefits:**
- Work on v3.0.24 while developing v3.1.0
- Test different versions side-by-side
- Install from specific version tarballs
- Backwards compatible via symlinks

### Build Tools

- **SWC** - Fast TypeScript/JavaScript transpiler
- **esbuild** - Bundles peer dependencies for CLI
- **Jest** - Testing framework with @swc/jest transformer
- **ESLint + Prettier** - Code quality and formatting

### Testing Strategy

- **Unit tests** - Co-located `.test.js` files in `tests/` using Jest
- **Integration tests** - Full build tool integration in `integrations/`
- **Test tools** - Various bundler integrations (Webpack, Parcel, Rollup, etc.)

### Key Architectural Concepts

**PostCSS Pipeline:**
1. User's CSS passes through PostCSS
2. Tailwind plugin processes `@tailwind` directives
3. Utilities are generated based on content scanning
4. `@apply` directives are expanded
5. Final CSS is optimized and output

**Content Scanning:**
- Uses `fast-glob` to find source files
- Extracts class name candidates via regex
- Generates only the CSS for used utilities

**Configuration System:**
- Loads `tailwind.config.js` from project root
- Merges with default configuration
- Supports theme customization and plugins
- Uses `lilconfig` for flexible config loading

**Plugin System:**
- Plugins register utilities, components, and base styles
- Use `addUtilities()`, `addComponents()`, `addBase()` APIs
- Can access theme values and variants
- Support for custom variants via `addVariant()`
